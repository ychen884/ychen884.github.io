<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Distributed Systems Notes - Currently Upating... | Yizhou Chen</title> <meta name="author" content="Yizhou Chen"> <meta name="description" content="Distributed Systems Notes - SCS"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://ychen884.github.io/blog/2024/15640/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Yizhou </span>Chen</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Distributed Systems Notes - Currently Upating...</h1> <p class="post-meta">January 18, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/cmu"> <i class="fas fa-hashtag fa-sm"></i> CMU</a>     ·   <a href="/blog/category/study"> <i class="fas fa-tag fa-sm"></i> Study</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h3 id="course-evaluation-final-grade-na">Course Evaluation (Final grade: N/A)</h3> <p>I will add my course evaluation at the end of this semester.</p> <h3 id="paper-reviews">Paper reviews</h3> <p>I will upload my paper reviews here later.</p> <h2 id="blog-chapters"><strong>Blog Chapters</strong></h2> <ol> <li><a href="#topic-1">Chapter 1: Remote Procedure Call (RPC)</a></li> <li><a href="#topic-2">Chapter 2: Caching</a></li> <li><a href="#topic-3">Chapter 3: </a></li> <li><a href="#topic-4">Chapter 4: </a></li> <li><a href="#topic-5">Chapter 5: </a></li> <li><a href="#topic-6">Chapter 6: </a></li> <li><a href="#topic-7">Chapter 7: </a></li> </ol> <h2 id="-chapter-1-remote-procedure-call-rpc--">** Chapter 1: Remote Procedure Call (RPC) ** <a name="topic-1"></a> </h2> <ul> <li>Try to fake procedure call to local programming</li> <li>Why? bring down programming complexity for distributed systems</li> <li>client-server model, per interface</li> <li>two aspects: control flow, invocation syntax</li> <li>with network delays (theoretically best at speed of light)</li> </ul> <h5 id="limitations-of-rpc">limitations of RPC</h5> <ol> <li>No address space sharing between client and server, can’t sharing pointers(call by reference), can’t share global data..</li> <li>Delayed binding in RPC</li> </ol> <h5 id="failure-independence">Failure independence</h5> <ul> <li>caller and callee live and die together in local setup</li> <li>we can witness failure case but hard to do in local</li> <li>failure handling consider visibility of failure</li> <li>Security: different domains</li> </ul> <h5 id="typical-rpc">Typical RPC</h5> <ul> <li>client: makerpc(request_packet, &amp;reply_packet): blocks until reply or failure</li> <li>server: getrequest(&amp;request_packet) blocks until receives request, sendresponse(reply_packet)</li> </ul> <h5 id="stub-routines">Stub routines</h5> <ul> <li>generated by stub generator</li> <li>sit between high level purpose and low level network packing/unpacking send/recv.. <h6 id="procedure">procedure:</h6> <p>``` -&gt; : local procedure call –: network communication</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  Client                                             Server App -&gt; Stub -&gt; Transport --Network Com--- Transport -&gt; Stub -&gt; App
</code></pre></div> </div> </li> </ul> <p>App calls Stub Stub pack/unpack Transport transmit/receive Server App do actual work then return Packing and unpacking is usually not elastic in dev env Correctness and API design is more important</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Marshalling/Unmarshalling, Serialization/De-serialization

##### RPC packet format
1. Network transport header(Ethernet, IP, Transport(TCP/UDP))
2. RPC header
</code></pre></div></div> <p>RPC Version ID Opcode (Stub) Flags parameters + Len</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
##### Stub with dynamically allocated buffer
- variable to indicate how many bytes in coming
- malloc for new memories


##### Failure independence of clients &amp; servers adds complexity
1. Outsourcing (for example, relying on TCP). TCP guarantees reliable, in-order, unlimited delivery.
</code></pre></div></div> <p>Pain:</p> <ul> <li>no preservation of write() boundaries</li> <li>data is re-framed in transit</li> <li>read may return fewer than number of bytes requested</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2. The buck has to stop somewhere. Do it yourself.
- Retransmission
- duplicate delivery/execution violates RPC semantics, sequence numbering to eliminate
- based on UDP



##### Timeout values in distributed systems
- statistics -&gt; reasonable
- no matter what, could be too soon

##### What does server do when receiving duplication happens?
- indicates one of these happening: 
1. reply lost
2. reply crossed retransmitted request
3. compute time was excessive
4. client too impatient.
5. ...


##### Knowlege at server is always stale relative to client, and vice versa
- processing time/network transmit time, indifferent to client..
- best for server to do is retrans
- should preserve reply, not re-compute, because computation can be substantial
- *my question: what if replies too large? maybe best effort

##### Exactly-once semantics
- How long to keep old replies and sequence numbers
- Rigorous interpretation of "RPC" -&gt; forever
- Server crashes: 
- - saved in non-volatile
- - server response has to be after non-volatile write
- - disk/flash latency per RPC
- - clean undo of partial computations before crash
- exactly-once RPC: 
- - success return -&gt; call exected exactly once
- - call blocks indefinitely, no failure return



##### In practice for RPC package: At-most-once semantics 
</code></pre></div></div> <p>Avoid indefinite blocking Declare timeout beyond certain delay: success or not? many timeout reasons…</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
##### Slow Servers &amp; Long-Running Calls
</code></pre></div></div> <p>Solution: probes to check server health during long calls server responds busy while working essentially a keepalive mechanism</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
##### Orphaned Computations
</code></pre></div></div> <p>network failure, then server continues, unaware its work is useless Orphan detection and extermination are difficult - but important</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
##### At-least-once semantics (strongest)
</code></pre></div></div> <p>Even simpler to implement Requires operation idempotency Idempotency is a property of certain operations or API requests, which guarantees that performing the operation multiple times will yield the same result as if it was executed only once.</p> <ul> <li>for example, read request on locked object or read-only object, current_stock_price(MSFT) ```</li> </ul> <h6 id="choice-of-semantics-less-strong">Choice of semantics (less strong)</h6> <ol> <li>Achieving exactly-once semantics <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>not provided in any real RPC package
requrie application-level dup elim
built on top of at-most-once RPC
- have to write on disk before replying
</code></pre></div> </div> </li> <li>At-most-once (mostly provided by RPC packages) ``` avoids: <ul> <li>transactional storage</li> <li>non-volatile storageo of replies and sequence #s</li> <li>indefinite storage of replies</li> </ul> </li> </ol> <p>if crashed, just crash without executing anything exactly once: have to undo, and do again using instruction in non-vol</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
##### Safety and liveness properties
</code></pre></div></div> <p>safety: correct functionalty (“At most one entity can execute in a critical section”)</p> <ul> <li>bad things never happen</li> </ul> <p>liveness: characterizes timely execution progress (e.g., “This code is deadlock-free”)</p> <ul> <li>good things will eventually happen ```</li> <li>“Exactly-once semantics” -&gt; safety property</li> <li>Existence of timeout in at-most-once RPC -&gt; liveness property</li> </ul> <h5 id="placement-of-functionality---what-are-you-promising-vs-deliver">Placement of Functionality - what are you promising vs deliver</h5> <ul> <li>Protocol layering</li> </ul> <h5 id="tcp-for-rpc">TCP for RPC</h5> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TCP timeout -&gt; reconnect
- new connection is unaware of old
- server need to do dup elim
- orphans still possible
- exactly-once RPC no easier with TCP

TCO simplifies at-most-once RPC
TCP hurts since it has independent acks in each direction


User TCP rather UDP:
- not simplify exactly-once imple
- worse performance in best case
- simplify at-most once impl

End-to-end argument:
For a given functionality:
- correctness is expressed relative to two endpoints (safety)
- implementation requires support of those two end points
- support below end points cannot suffice (may improve performance(liveness))

</code></pre></div></div> <h5 id="critical-question-where-to-place-function-in-a-distributed-system">Critical question: Where to place function in a distributed system?</h5> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>What guarantee promising
end point 
package
simplified implementation
guarantee properties
</code></pre></div></div> <h5 id="performance-of-distributed-system-delay">Performance of distributed system: delay</h5> <ol> <li>Processing delay</li> <li>Queueing delay &lt;- dominate</li> <li>Tranmission &lt;- usuallly small unless very large files</li> </ol> <h5 id="queueing">Queueing</h5> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Any shared resources
Arrival pattern: uniform, poisson, ...

Service time also varies

---- without considering real world complications:----
1. Util
2. Latency
3. Freedom (how constrained of arrival discipline..) 
We can optimize at most 2 out of 3




</code></pre></div></div> <h5 id="latency-is-the-killer">Latency is the killer</h5> <h2 id="chapter-2-caching-">Chapter 2: Caching <a name="topic-2"></a> </h2> <h5 id="metrics">Metrics</h5> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Miss Ratio = Misses/References
Hit Ratio = Hits/References = (1 − Miss Ratio)
Expected cost of a reference = (Miss Ratio * cost of miss) + (Hit Ratio * cost of hit)
Cache Advantage = (Cost of Miss / Cost of Hit)
</code></pre></div></div> <h5 id="fopcus-distributed-file-systems">Fopcus: distributed file systems</h5> <ol> <li>Fetch policy ``` Full Replication? -Storage for entire subtree consumed on every replica -Significant update traffic on hot spots -Machines receive updates whether they care or not Coarse-grain, non-selective management of data</li> </ol> <p>A Much Better Approach: on-demand caching</p> <ul> <li>requires operating system modifications</li> <li>total application transparency</li> <li>enable demand caching</li> </ul> <p>Multi-OS On-Demand Caching</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2. Update propagation policy
3. Cache replacement policy ((prefetching))

##### Caching in the Real World
1.  Cost of remote data access often not uniform
2.  spatial locality
3.  Remote data more coarsely addressable than local
Fetch more than you need on miss

##### Spatial &amp; Temporal Locality


##### Update Propagation
</code></pre></div></div> <p>One-copy semantics • there are no externally observable functional differences • relative to same system without caching (or replication)</p> <p>This model aims to provide the illusion that although data may be replicated across multiple servers or nodes (to improve reliability, performance, and fault tolerance), users interact with the data as if there is only one copy.</p> <p>Challenges: Physical master copy may not exist Network may break between some users and master copy Intense read- and write-sharing across sites (The benefits of caching (reducing access time, decreasing bandwidth usage) are undermined in this scenario. The caches might spend more time synchronizing than serving the actual read and write requests, making them “effectively useless”)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
##### Cache Consistency Strategies
1. Broadcast Invalidations
</code></pre></div></div> <p>Notification to All Caching Sites:every caching site in the network is notified, regardless of whether they actually have the cached object.</p> <p>Handling at Cache Sites: Upon receiving the invalidation notice, if a cache has the invalidated object, it will mark it as invalid.</p> <p>Strengths</p> <ul> <li>Strict One-Copy Semantics:</li> <li>Race Condition Prevention: If the updating process is blocked until all caches have invalidated the item, it prevents race conditions, ensuring that no stale reads occur.</li> <li>Simplicity</li> </ul> <p>Limitations</p> <ul> <li>Wasted Traffic:</li> <li>Blocking Updating Process:</li> <li>Scalability Issues: As the number of nodes in the system increases, the overhead of sending invalidations to every node and the corresponding acknowledgments becomes impractical. ```</li> </ul> <ol> <li>Check on Use: ``` Reader checks master copy before each use Has to be done at coarse granularity (e.g. entire file or large block) Whole file granularity-&gt; “session semantics”</li> </ol> <p>Advantages • strict consistency at coarse granularity • easy to implement, no server state • servers don’t need to know of caching sites ```</p> <p><a href="#blog-chapters">Back to Blog Chapters</a></p> <p><a href="#blog-chapters">Back to Blog Chapters</a></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/15661/">Compiler Design Notes - Currently Upating...</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/15719/">Advanced Cloud Computing Notes - Currently Upating...</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/15513/">Computer Systems - Currently Updating...</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/14741/">Information Security - Currently Updating...</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/14740/">Fundamentals of Telecommunication Networks - Currently Upating...</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Yizhou Chen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/copy_code.js" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>